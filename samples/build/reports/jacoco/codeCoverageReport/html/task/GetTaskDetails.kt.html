<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GetTaskDetails.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ibd-service</a> &gt; <a href="index.source.html" class="el_package">task</a> &gt; <span class="el_source">GetTaskDetails.kt</span></div><h1>GetTaskDetails.kt</h1><pre class="source lang-java linenums">package task

import java.math.BigDecimal
import java.sql.Date
import java.sql.PreparedStatement
import java.sql.ResultSet
import java.sql.Timestamp
import kotlin.Int
import kotlin.String
import norm.ParamSetter
import norm.Query
import norm.RowMapper
import org.postgresql.util.PGobject

<span class="fc" id="L15">data class GetTaskDetailsParams(</span>
<span class="fc" id="L16">  val id: Int?</span>
)

<span class="fc" id="L19">class GetTaskDetailsParamSetter : ParamSetter&lt;GetTaskDetailsParams&gt; {</span>
  override fun map(ps: PreparedStatement, params: GetTaskDetailsParams) {
<span class="fc" id="L21">    ps.setObject(1, params.id)</span>
<span class="fc" id="L22">  }</span>
}

<span class="fc" id="L25">data class GetTaskDetailsResult(</span>
<span class="fc" id="L26">  val patientFirstName: String,</span>
<span class="fc" id="L27">  val patientLastName: String,</span>
<span class="fc" id="L28">  val patientDob: Date?,</span>
<span class="fc" id="L29">  val patientGender: String,</span>
<span class="fc" id="L30">  val patientEmail: String?,</span>
<span class="fc" id="L31">  val patientTelephone: String?,</span>
<span class="fc" id="L32">  val patientMobile: String?,</span>
<span class="fc" id="L33">  val patientAddress: PGobject?,</span>
<span class="fc" id="L34">  val insuranceName: String?,</span>
<span class="fc" id="L35">  val insuranceId: String?,</span>
<span class="fc" id="L36">  val groupNumber: String?,</span>
<span class="fc" id="L37">  val bin: String?,</span>
<span class="fc" id="L38">  val pcn: String?,</span>
<span class="fc" id="L39">  val insuranceType: String?,</span>
<span class="fc" id="L40">  val doctorFirstName: String,</span>
<span class="fc" id="L41">  val doctorLastName: String,</span>
<span class="fc" id="L42">  val doctorNpi: String,</span>
<span class="fc" id="L43">  val doctorMobile: String?,</span>
<span class="fc" id="L44">  val doctorFax: String?,</span>
<span class="fc" id="L45">  val doctorEmail: String?,</span>
<span class="fc" id="L46">  val doctorAddress: PGobject?,</span>
<span class="fc" id="L47">  val rxNumber: String,</span>
<span class="fc" id="L48">  val fillNumber: Int,</span>
<span class="fc" id="L49">  val drugName: String,</span>
<span class="fc" id="L50">  val directions: String?,</span>
<span class="fc" id="L51">  val ndc: String,</span>
<span class="fc" id="L52">  val drugForm: String?,</span>
<span class="fc" id="L53">  val diagnosisCode: String?,</span>
<span class="fc" id="L54">  val awp: BigDecimal?,</span>
<span class="fc" id="L55">  val amount: BigDecimal,</span>
<span class="fc" id="L56">  val daysSupply: Int?,</span>
<span class="fc" id="L57">  val refills: Int,</span>
<span class="fc" id="L58">  val quantity: BigDecimal?,</span>
<span class="fc" id="L59">  val rxCreated: Timestamp?,</span>
<span class="fc" id="L60">  val status: String?,</span>
<span class="fc" id="L61">  val keycode: String?,</span>
<span class="fc" id="L62">  val caseId: String?,</span>
<span class="fc" id="L63">  val pbmCompany: String?,</span>
<span class="fc" id="L64">  val paNotPossibleReason: String?,</span>
<span class="fc" id="L65">  val paNotPossibleNote: String?,</span>
<span class="fc" id="L66">  val paNumber: String?,</span>
<span class="fc" id="L67">  val paApprovalDate: Date?,</span>
<span class="fc" id="L68">  val extraInfoType: String?,</span>
<span class="fc" id="L69">  val extraInfoNote: String?,</span>
<span class="fc" id="L70">  val paDeniedReferenceNumber: String?,</span>
<span class="fc" id="L71">  val paDeniedDate: Date?,</span>
<span class="fc" id="L72">  val paDeniedReason: String?,</span>
<span class="fc" id="L73">  val paDeniedNote: String?,</span>
<span class="fc" id="L74">  val altMedicationDrug: String?,</span>
<span class="fc" id="L75">  val altMedicationSig: String?,</span>
<span class="fc" id="L76">  val altMedicationQuantity: BigDecimal?,</span>
<span class="fc" id="L77">  val altMedicationRefills: Int?,</span>
<span class="fc" id="L78">  val extraMedicalInfoType: String?,</span>
<span class="fc" id="L79">  val extraMedicalInfoNote: String?,</span>
<span class="fc" id="L80">  val type: String,</span>
<span class="fc" id="L81">  val eventTimestamp: Timestamp?,</span>
<span class="fc" id="L82">  val userId: Int?,</span>
<span class="fc" id="L83">  val fullName: String?,</span>
<span class="fc" id="L84">  val userName: String?</span>
)

<span class="fc" id="L87">class GetTaskDetailsRowMapper : RowMapper&lt;GetTaskDetailsResult&gt; {</span>
<span class="fc" id="L88">  override fun map(rs: ResultSet): GetTaskDetailsResult = GetTaskDetailsResult(</span>
<span class="fc" id="L89">  patientFirstName = rs.getObject(&quot;patient_first_name&quot;) as kotlin.String,</span>
<span class="fc" id="L90">    patientLastName = rs.getObject(&quot;patient_last_name&quot;) as kotlin.String,</span>
<span class="fc" id="L91">    patientDob = rs.getObject(&quot;patient_dob&quot;) as java.sql.Date?,</span>
<span class="fc" id="L92">    patientGender = rs.getObject(&quot;patient_gender&quot;) as kotlin.String,</span>
<span class="fc" id="L93">    patientEmail = rs.getObject(&quot;patient_email&quot;) as kotlin.String?,</span>
<span class="fc" id="L94">    patientTelephone = rs.getObject(&quot;patient_telephone&quot;) as kotlin.String?,</span>
<span class="fc" id="L95">    patientMobile = rs.getObject(&quot;patient_mobile&quot;) as kotlin.String?,</span>
<span class="fc" id="L96">    patientAddress = rs.getObject(&quot;patient_address&quot;) as org.postgresql.util.PGobject?,</span>
<span class="fc" id="L97">    insuranceName = rs.getObject(&quot;insurance_name&quot;) as kotlin.String?,</span>
<span class="fc" id="L98">    insuranceId = rs.getObject(&quot;insurance_id&quot;) as kotlin.String?,</span>
<span class="fc" id="L99">    groupNumber = rs.getObject(&quot;group_number&quot;) as kotlin.String?,</span>
<span class="fc" id="L100">    bin = rs.getObject(&quot;bin&quot;) as kotlin.String?,</span>
<span class="fc" id="L101">    pcn = rs.getObject(&quot;pcn&quot;) as kotlin.String?,</span>
<span class="fc" id="L102">    insuranceType = rs.getObject(&quot;insurance_type&quot;) as kotlin.String?,</span>
<span class="fc" id="L103">    doctorFirstName = rs.getObject(&quot;doctor_first_name&quot;) as kotlin.String,</span>
<span class="fc" id="L104">    doctorLastName = rs.getObject(&quot;doctor_last_name&quot;) as kotlin.String,</span>
<span class="fc" id="L105">    doctorNpi = rs.getObject(&quot;doctor_npi&quot;) as kotlin.String,</span>
<span class="fc" id="L106">    doctorMobile = rs.getObject(&quot;doctor_mobile&quot;) as kotlin.String?,</span>
<span class="fc" id="L107">    doctorFax = rs.getObject(&quot;doctor_fax&quot;) as kotlin.String?,</span>
<span class="fc" id="L108">    doctorEmail = rs.getObject(&quot;doctor_email&quot;) as kotlin.String?,</span>
<span class="fc" id="L109">    doctorAddress = rs.getObject(&quot;doctor_address&quot;) as org.postgresql.util.PGobject?,</span>
<span class="fc" id="L110">    rxNumber = rs.getObject(&quot;rx_number&quot;) as kotlin.String,</span>
<span class="fc" id="L111">    fillNumber = rs.getObject(&quot;fill_number&quot;) as kotlin.Int,</span>
<span class="fc" id="L112">    drugName = rs.getObject(&quot;drug_name&quot;) as kotlin.String,</span>
<span class="fc" id="L113">    directions = rs.getObject(&quot;directions&quot;) as kotlin.String?,</span>
<span class="fc" id="L114">    ndc = rs.getObject(&quot;ndc&quot;) as kotlin.String,</span>
<span class="fc" id="L115">    drugForm = rs.getObject(&quot;drug_form&quot;) as kotlin.String?,</span>
<span class="fc" id="L116">    diagnosisCode = rs.getObject(&quot;diagnosis_code&quot;) as kotlin.String?,</span>
<span class="fc" id="L117">    awp = rs.getObject(&quot;awp&quot;) as java.math.BigDecimal?,</span>
<span class="fc" id="L118">    amount = rs.getObject(&quot;amount&quot;) as java.math.BigDecimal,</span>
<span class="fc" id="L119">    daysSupply = rs.getObject(&quot;days_supply&quot;) as kotlin.Int?,</span>
<span class="fc" id="L120">    refills = rs.getObject(&quot;refills&quot;) as kotlin.Int,</span>
<span class="fc" id="L121">    quantity = rs.getObject(&quot;quantity&quot;) as java.math.BigDecimal?,</span>
<span class="fc" id="L122">    rxCreated = rs.getObject(&quot;rx_created&quot;) as java.sql.Timestamp?,</span>
<span class="fc" id="L123">    status = rs.getObject(&quot;status&quot;) as kotlin.String?,</span>
<span class="fc" id="L124">    keycode = rs.getObject(&quot;keycode&quot;) as kotlin.String?,</span>
<span class="fc" id="L125">    caseId = rs.getObject(&quot;case_id&quot;) as kotlin.String?,</span>
<span class="fc" id="L126">    pbmCompany = rs.getObject(&quot;pbm_company&quot;) as kotlin.String?,</span>
<span class="fc" id="L127">    paNotPossibleReason = rs.getObject(&quot;pa_not_possible_reason&quot;) as kotlin.String?,</span>
<span class="fc" id="L128">    paNotPossibleNote = rs.getObject(&quot;pa_not_possible_note&quot;) as kotlin.String?,</span>
<span class="fc" id="L129">    paNumber = rs.getObject(&quot;pa_number&quot;) as kotlin.String?,</span>
<span class="fc" id="L130">    paApprovalDate = rs.getObject(&quot;pa_approval_date&quot;) as java.sql.Date?,</span>
<span class="fc" id="L131">    extraInfoType = rs.getObject(&quot;extra_info_type&quot;) as kotlin.String?,</span>
<span class="fc" id="L132">    extraInfoNote = rs.getObject(&quot;extra_info_note&quot;) as kotlin.String?,</span>
<span class="fc" id="L133">    paDeniedReferenceNumber = rs.getObject(&quot;pa_denied_reference_number&quot;) as kotlin.String?,</span>
<span class="fc" id="L134">    paDeniedDate = rs.getObject(&quot;pa_denied_date&quot;) as java.sql.Date?,</span>
<span class="fc" id="L135">    paDeniedReason = rs.getObject(&quot;pa_denied_reason&quot;) as kotlin.String?,</span>
<span class="fc" id="L136">    paDeniedNote = rs.getObject(&quot;pa_denied_note&quot;) as kotlin.String?,</span>
<span class="fc" id="L137">    altMedicationDrug = rs.getObject(&quot;alt_medication_drug&quot;) as kotlin.String?,</span>
<span class="fc" id="L138">    altMedicationSig = rs.getObject(&quot;alt_medication_sig&quot;) as kotlin.String?,</span>
<span class="fc" id="L139">    altMedicationQuantity = rs.getObject(&quot;alt_medication_quantity&quot;) as java.math.BigDecimal?,</span>
<span class="fc" id="L140">    altMedicationRefills = rs.getObject(&quot;alt_medication_refills&quot;) as kotlin.Int?,</span>
<span class="fc" id="L141">    extraMedicalInfoType = rs.getObject(&quot;extra_medical_info_type&quot;) as kotlin.String?,</span>
<span class="fc" id="L142">    extraMedicalInfoNote = rs.getObject(&quot;extra_medical_info_note&quot;) as kotlin.String?,</span>
<span class="fc" id="L143">    type = rs.getObject(&quot;type&quot;) as kotlin.String,</span>
<span class="fc" id="L144">    eventTimestamp = rs.getObject(&quot;event_timestamp&quot;) as java.sql.Timestamp?,</span>
<span class="fc" id="L145">    userId = rs.getObject(&quot;user_id&quot;) as kotlin.Int?,</span>
<span class="fc" id="L146">    fullName = rs.getObject(&quot;full_name&quot;) as kotlin.String?,</span>
<span class="fc" id="L147">    userName = rs.getObject(&quot;user_name&quot;) as kotlin.String?)</span>
}

<span class="fc" id="L150">class GetTaskDetailsQuery : Query&lt;GetTaskDetailsParams, GetTaskDetailsResult&gt; {</span>
<span class="fc" id="L151">  override val sql: String = &quot;&quot;&quot;</span>
      |SELECT p.patient_first_name, p.patient_last_name, p.patient_dob, p.patient_gender, p.patient_email,
      |p.patient_telephone, p.patient_mobile,p.patient_address,p.insurance_name, p.insurance_id,p.group_number,p.bin,
      |p.pcn,p.insurance_type,p.doctor_first_name, p.doctor_last_name,p.doctor_npi,p.doctor_mobile,p.doctor_fax,
      |p.doctor_email, p.doctor_address,p.rx_number,p.fill_number,p.drug_name,p.directions, p.ndc, p.drug_form,
      |p.diagnosis_code, p.awp, p.amount, p.days_supply,p.refills,p.quantity,p.rx_created, t.status,
      |(t.additional_information).keycode, (t.additional_information).case_id, (t.additional_information).pbm_company,
      |(t.additional_information).pa_not_possible_reason, (t.additional_information).pa_not_possible_note,
      |(t.additional_information).pa_number, (t.additional_information).pa_approval_date, (t.additional_information).extra_info_type,
      |(t.additional_information).extra_info_note, (t.additional_information).pa_denied_reference_number, (t.additional_information).pa_denied_date,
      |(t.additional_information).pa_denied_reason, (t.additional_information).pa_denied_note,
      |(t.additional_information).alt_medication_drug, (t.additional_information).alt_medication_sig, (t.additional_information).alt_medication_quantity, (t.additional_information).alt_medication_refills,
      |(t.additional_information).extra_medical_info_type, (t.additional_information).extra_medical_info_note,
      |t.type,
      |l.event_timestamp, u.id as user_id, u.full_name, u.user_name
      |FROM prescriptions p
      |inner join pa_tasks t on t.prescription_id=p.id
      |left join users u on t.user_name = u.user_name
      |left join logs l on l.id=t.id AND exist(changed_fields,'status')
      |WHERE t.id=? ORDER BY event_timestamp desc LIMIT 1;
<span class="fc" id="L171">      |&quot;&quot;&quot;.trimMargin()</span>

<span class="fc" id="L173">  override val mapper: RowMapper&lt;GetTaskDetailsResult&gt; = GetTaskDetailsRowMapper()</span>

<span class="fc" id="L175">  override val paramSetter: ParamSetter&lt;GetTaskDetailsParams&gt; = GetTaskDetailsParamSetter()</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>